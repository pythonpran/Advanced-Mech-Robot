import RPi.GPIO as GPIO
import time

# Define the IR sensor pins
IR_PINS = [4, 17, 18]

# Store current states in a dictionary
ir_states = {pin: 1 for pin in IR_PINS}  # assume HIGH = no signal initially

def ir_callback(channel):
    """Callback triggered automatically when an IR sensor changes state."""
    state = GPIO.input(channel)
    ir_states[channel] = state
    if state == 0:
        print(f"IR sensor on GPIO {channel} DETECTED signal")
    else:
        print(f"IR sensor on GPIO {channel} LOST signal")

def setup_ir():
    GPIO.setmode(GPIO.BCM)
    for pin in IR_PINS:
        GPIO.setup(pin, GPIO.IN, pull_up_down=GPIO.PUD_UP)
        GPIO.add_event_detect(pin, GPIO.BOTH, callback=ir_callback, bouncetime=30)

def read_ir_sensors():
    """Return current states of all IR sensors without blocking."""
    return {pin: GPIO.input(pin) for pin in IR_PINS}

def main():
    setup_ir()
    print("Monitoring IR sensors on GPIO 4, 17, 18 (non-blocking).")
    print("Press Ctrl+C to exit.\n")

    try:
        while True:
            # You can do other logic here (motors, sensors, etc.)
            current = read_ir_sensors()
            # Example of using the data non-blockingly:
            # print("Current IR states:", current)
            time.sleep(0.2)
    except KeyboardInterrupt:
        print("\nExiting.")
    finally:
        GPIO.cleanup()

if __name__ == "__main__":
    main()
